<div class="container-fluid main-container background-standard">
  <div class="row justify-content-center align-items-center">
    <div class="col p-0">
      <div class="second-container">
        <div class="profile-header">
          <%= link_to :back, class: "m-4 back-button" do %>
          <img src="<%= image_path('back.png') %>" alt="back" class="nav-icon">
          <% end %>
          <h3 class="title-profile-style text-center">Mes plateformes</h3>
        </div>
        <div class="profile-body">
          <div class="text-center profile-avatar">
            <%= image_tag(current_user.avatar, class: "avatar-large", alt: "avatar")%>
          </div>
          <%= form_with(model: current_user, url: user_platforms_path, method: :post, local: true) do |f| %>
          <div data-controller="platform">
            <div class="d-flex justify-content-around">
              <% PLATFORMS.each_with_index do |provider_name, index| %>
              <div class="platform-selection">
                <%= image_tag "#{provider_name[:name].downcase.gsub(' ', '_')}_logo.png",
                    alt: "#{provider_name[:name]} logo",
                    class: "platform-logo #{'selected' if @user_streaming_ids.include?(provider_name[:id])}",
                     data: { action: "click->platform#toggleSelection", platform: provider_name[:name], target: "platform.platform" } %>
            <%= f.hidden_field :selected_platforms,
                  name: 'user[selected_platforms][]',
                  value: provider_name[:name],
                  id: "hiddenField#{index}",
                  disabled: !@user_streaming_ids.include?(provider_name[:id]),
                  data: { platform: provider_name[:name], target: "platform.hiddenField" } %>
          </div>
              <% end %>
            </div>
          </div>
          <div class="d-flex justify-content-center mt-4">
            <%= f.submit "Enregistrer", class:"button-standard mt-5"%>
          </div>
          <% end %>
        </div>
      </div>
    </div>

  </div>

</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.platform-logo').forEach(function (logo) {
      logo.addEventListener('click', function () {
        this.classList.toggle('selected');
        var targetFieldId = this.dataset.target;
        var hiddenField = document.getElementById(targetFieldId);
        hiddenField.disabled = !hiddenField.disabled;
      });
    });
  });
</script>
